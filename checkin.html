<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>受付フォーム</title>
</head>
<body>
  <h2>名前（カタカナ）で検索</h2>
  <input type="text" id="searchInput" placeholder="例：カナザワ">
  <button onclick="search()">検索</button>
  <div id="result"></div>

  <script>
    const GAS_URL = "https://reception.esthepro-shinya.workers.dev/";

    async function search() {
      const keyword = document.getElementById("searchInput").value.trim();
      const res = await fetch(GAS_URL);
      const data = await res.json();

      const match = data.find(row => row["カタカナ"] && row["カタカナ"].includes(keyword));

      const resultDiv = document.getElementById("result");
      if (match) {
        resultDiv.innerHTML = `
          <p><strong>お名前:</strong> ${match["お名前"]}</p>
          <p><strong>店舗:</strong> ${match["店舗"]}</p>
          <p><strong>お席:</strong> ${match["お席"]}</p>
          <button onclick='checkIn("${match["カタカナ"]}")'>受付する</button>
        `;
      } else {
        resultDiv.innerHTML = "該当者が見つかりませんでした";
      }
    }

    async function checkIn(katakana) {
      const response = await fetch(GAS_URL + `?katakana=${encodeURIComponent(katakana)}`, {
        method: "POST"
      });
      const text = await response.text();
      alert(text === "OK" ? "受付完了しました！" : "受付に失敗しました");
      location.reload();
    }
  </script>
</body>
</html>
